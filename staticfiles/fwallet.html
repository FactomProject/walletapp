<!DOCTYPE html>
<html>
<head>
    <title>Factoid Wallet GUI</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" type="image/png" href="./images/favicon.png">
    <link rel="stylesheet" href="jquery-ui.css">

    <script type="text/javascript" src="jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="tooltip.js"></script>
    <script type="text/javascript" src="popover.js"></script>
    <script type="text/javascript" src="jquery-ui.js"></script>
    <link rel="stylesheet" href="bootstrap.min.css">


        <script type="text/javascript" charset="utf-8">
            var currTabIdx = 5;
            
            function showRate(){
              var elem = document.getElementById('conversionRate');
              elem.style.display = 'inline';
              $.ajax({
                   url: 'rate',
                   type: 'get',
                   dataType: 'html',
                   success : function(data) {
                         if(data === '') {
                             $(elem).text('...');
                         } else {
                             $(elem).text('1 EC = ' + data + 'â¨Ž');
                         }
                   }
               });
            }

          var sendPost = function (calltype, postdata, outputBox, ifEmptyString) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: calltype, ajax_post_data: postdata },
                       success : function(data) {
                             if(data === '') {
                                 $(outputBox).text(ifEmptyString);
                             } else {
                                 $(outputBox).text(data);
                             }
                       },
                     });
                  };
                  
                  
          var updateTransaction = function (txInformation, performAction) {
                     var txKey = $("#transactionNameInput").val(); 
                     if(!txKey || txKey.length < 1) {
                        txKey = "UITX"
                        $("#transactionNameInput").val(txKey)
                     }
         
                     if(txInformation.length < 2) {
                        console.log("Error with # of stuff in txInfo");
                        return;
                     } else {
                        txInputs = txInformation[0];
                        txOutputs = txInformation[1];
                        if(performAction === "send") {
                            if(!balanceCheck()) {
                                  $('#txtBox').text("Transaction imbalanced (the fee is much higher than it should be)!\n\nTransaction was not sent to network as a result.\n\nTo ensure the transaction is sent successfully, please make sure that the transaction fee being paid is less than 10 times the required fee.");
                                  return;
                            }
                         }
                         $.ajax({
                           url: 'tx',
                           type: 'get',
                           dataType: 'html',
                           data : { key: txKey, inputs: txInputs, outputs: txOutputs, action: performAction },
                           success : function(data) {
                                 if(performAction === "fee") {
                                     if(isNaN(data) || data === '' || typeof(data) === 'undefined') {
                                         $('#reqdFee').text("...");
                                         if(typeof(data) != 'undefined' && data != "...") {
                                            $('#txtBox').text(data);
                                         }
                                     } else {
                                         $('#reqdFee').text(data);
                                     }
                                 } else {
                                     if(data === '' || typeof(data) === 'undefined') {
                                         $('#txtBox').text("Transaction invalid");
                                     } else {
                                         $('#txtBox').text(data);
                                         if(data.endsWith("has been submitted to Factom.")) { //successfully-submitted transaction
                                                //clear all fields
                                                $("#inputTable").find("tr:gt(1)").not(':last').remove();
                                                $("#outputTable").find("tr:gt(2)").not(':last').remove();
                                                $( "#inputTable tr:nth-last-child(2)" ).children("td:first").find("input").val("");
                                                $( "#inputTable tr:nth-last-child(2)" ).children("td:eq(1)").find("input").val("");
                                                $( "#outputTable tr:nth-last-child(3)" ).children("td:first").find("input").val("");
                                                $( "#outputTable tr:nth-last-child(3)" ).children("td:eq(1)").find("input").val("");
                                                $( "#transactionNameInput" ).val("");
                                                updateInputTotals();
                                                updateOutputTotals();
                                         }
                                     }
                                 }
                           },
                         }); 
                      }
                  };


          var updateFee = function () {
                     var txKey = $("#transactionNameInput").val(); 
                     if(!txKey || txKey.length < 1) {
                        txKey = "UITX"
                        $("#transactionNameInput").val(txKey)
                     }
         

                         $.ajax({
                           url: 'fee',
                           type: 'get',
                           dataType: 'html',
                           data : { key: txKey },
                           success : function(data) {
                                     if(isNaN(data) || data === '' || typeof(data) === 'undefined') {
                                         $('#reqdFee').text("...");
                                         if(typeof(data) != 'undefined' && data != "...") {
                                            $('#txtBox').text("Wallet is offline");
                                         }
                                     } else {
                                         $('#reqdFee').text(data);
                                     }
                           }
                         });
          }
                                 
                  
          var balanceCheck = function() {
                var reqFee = parseFloat($('#reqdFee').text());
                var currFee = parseFloat($('#feeLabel').text());
                if(!isNaN(reqFee)) {
                    return(currFee <= (reqFee*10));
                } else {
                    return false;
                }
          };
                  
          var submitTx = function (txInputs, txOutputs) {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                    txKey = "UITX"
                    $("#transactionNameInput").val(txKey)
                 }
                     $.ajax({
                       url: 'tx',
                       type: 'get',
                       dataType: 'html',
                       data : { key: txKey, inputs: txInputs, outputs: txOutputs, action: "send" },
                       success : function(data) {
                             if(data === '' || typeof(data) === 'undefined') {
                                 $('#txtBox').text("Transaction invalid");
                             } else {
                                 $('#txtBox').text(data);
                             }
                       },
                     });

          };

          var delTx = function () {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                    txKey = "UITX"
                    $("#transactionNameInput").val(txKey)
                 }
                     $.ajax({
                       url: 'deltx',
                       type: 'get',
                       dataType: 'html',
                       data : { key: txKey },
                       success : function(data) {
                             if(data === '' || typeof(data) === 'undefined') {
                                 $('#txtBox').text("Invalid transaction name.");
                             } else {
                                 $('#txtBox').text(data);
                             }
                       },
                     });

          };
                  
                          
          var updateFeeLabel = function () {
                var inputSize = parseFloat($('#inTotalInput').val());                
                var outputSize = parseFloat($('#outTotalInput').val());
                if (isNaN(outputSize) || outputSize === 0.0) {
                    var feeSize = inputSize
                } else {
                    var feeSize = inputSize - outputSize
                }
                if (isNaN(feeSize)) {
                    feeSize = 0.00
                }
                $('#feeLabel').text((feeSize.toPrecision(8) / 1).toString());   //divide by 1 to truncate trailing 0's without any regex
          };
          
          var getBalance = function (address) {
                 sendPost("balance", address, "#txtBox", "0.0");
          };
                          
          var getBalances = function () {
                 sendPost("balances", '', "#txtBox", "NO BALANCES TO DISPLAY!");
          };
          
          var grabTx = function () {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                     $("#txtBox").text("Cannot load a no-name transaction.");
                 }
                 $.ajax({
                   url: 'loadtx',
                   type: 'post',
                   dataType: 'html',
                   data : { ajax_post_data: "", txName: txKey },
                   success : function(data) {
                         if(data === '') {
                             $("#txtBox").text("Transaction empty.");
                         } else {
                             $("#txtBox").text("Transaction loaded into " + txKey + " successfully!");
                             populatePageFields(data);
                         }
                   },
                 });
          
          };

          var loadTxFromFile = function (fileName) {
                     var txKey = $("#transactionNameInput").val(); 
                     if(!txKey || txKey.length < 1) {
                        txKey = "UITX"
                        $("#transactionNameInput").val(txKey)
                     }
                     $.ajax({
                       url: 'loadtx',
                       type: 'post',
                       dataType: 'html',
                       data : { ajax_post_data: fileName, txName: txKey },
                       success : function(data) {
                             if(data === '') {
                                 $("#txtBox").text("No such file.");
                             } else {
                                $("#txtBox").text("Transaction loaded into " + txKey + " successfully!");
                                populatePageFields(data);
                             }
                       },
                     });
        
          };

          var populatePageFields = function(data) {
                    try {
                        var returnedTX = JSON.parse(data);
                    } catch (e) {
                         $("#txtBox").text(data); // + "\n\nThe output above is not a properly-JSON-formatted factoid transaction.");
                         return;
                    }
                    //$("#txtBox").text(data);
                    $("#inputTable").find("tr:gt(1)").not(':last').remove();
                    $("#outputTable").find("tr:gt(2)").not(':last').remove();
                    if(returnedTX) {
                        for(var inIdx=0; inIdx < returnedTX.Inputs.length; inIdx++) {
                            var thisInput = returnedTX.Inputs[inIdx];
                            $( "#inputTable tr:nth-last-child(2)" ).children("td:first").find("input").val(thisInput.inputAddress);
                            $( "#inputTable tr:nth-last-child(2)" ).children("td:eq(1)").find("input").val(thisInput.inputSize / 100000000);
                            $("#addi-button").trigger("click");
                        }
                          $( "#inputTable tr:nth-last-child(2)" ).children("td:nth-last-child(2)").find("button").trigger("click");
                          
                          
                        for(var outIdx=0; outIdx < returnedTX.Outputs.length; outIdx++) {
                            var thisOutput = returnedTX.Outputs[outIdx];
                            $( "#outputTable tr:nth-last-child(3)" ).children("td:first").find("input").val(thisOutput.outputAddress);
                            $( "#outputTable tr:nth-last-child(3)" ).children("td:eq(1)").find("input").val(thisOutput.outputSize / 100000000);
                            if(thisOutput.outputType === "ec") {
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=fct]").prop('checked', false);
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=ec]").prop('checked', true);
                            } else {
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=fct]").prop('checked', true);
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=ec]").prop('checked', false);
                            }
                            $("#addo-button").trigger("click");
                        }
                          $( "#outputTable tr:nth-last-child(3)" ).children("td:last").find("button").trigger("click");
                          updateInputTotals();
                          updateOutputTotals();
                          refreshFee();
                    }
          };
                      
          var getTxs = function () {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "allTxs", ajax_post_data: "" },
                       success : function(data) {
                             if(data === '') {
                                 $("#txtBox").text("NO TRANSACTIONS TO DISPLAY!");
                             } else {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };
          

          var addFCTAddress = function (addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "addNewAddress", ajax_post_data: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };
          
          var addECAddress = function (addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "addNewEC", ajax_post_data: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };
          
          var importPrivKey = function (privateKey, addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "importPrivKey", ajax_post_data: privateKey, addressName: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };

          var importTwelveWords = function (twelveWords, addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "importTwelveWords", ajax_post_data: twelveWords, addressName: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };

              
          var displayHelp = function () {
                 /*            $.ajax({
                               url: 'receive',
                               type: 'get',
                               dataType: 'html',
                               success : function(data) {
                                 $('#txtBox').text(data);
                               },
                             });
                   */          

                    $('[data-toggle="popover"]').popover("toggle"); 

                          };
            
          </script>


<style type="text/css">
    html, body {
        background: radial-gradient(ellipse at center,#303f9f 0%,#1a237e 100%);
        background-color: #303f9f;
        color:white;
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        font: 20px bold Georgia, "Times New Roman", Times, serif;
        text-shadow: 1px 1px #000000;
    }
    #txtBox {
        font-size: large; 
        font-weight: bold; 
        color: white; 
        background-color: transparent;
    }
    button {
        background-color: Transparent;
        border: none;
        outline:none;
        cursor:pointer;
        color: white;
    }
    td {
        text-align: center;
    }
    button img {
        display: block;
        height: 30px;  
        width: 30px;
    }
    textarea {
 background: url(./images/stripes.png) repeat-y;
 /*font: normal 14px verdana;*/
 line-height: 28px;

        box-sizing:border-box;
        -moz-box-sizing:border-box;
        -webkit-box-sizing:border-box;
        -moz-box-shadow: 1px 2px 3px rgba(0,0,0,.5);
        -webkit-box-shadow: 1px 2px 3px rgba(0,0,0,.5);
        box-shadow: 1px 2px 3px rgba(0,0,0,.5);
        border-radius: 10px;
        border-color: #0194C1;
        border-width: 2px;

    scrollbar-face-color: #0194C1;
    scrollbar-shadow-color: #FFFFFF;
    scrollbar-highlight-color: #FFFFFF;
    scrollbar-3dlight-color: #FFFFFF;
    scrollbar-darkshadow-color: #FFFFFF;
    scrollbar-track-color: #FFFFFF;
    scrollbar-arrow-color: #FFFFFF;
   


    }
    #inTotalInput, #outTotalInput {
        background-color: Transparent;
        color: white;
        border-radius: 25px;
        -moz-box-shadow: 1px 2px 3px rgba(0,0,0,.5);
        -webkit-box-shadow: 1px 2px 3px rgba(0,0,0,.5);
        box-shadow: 1px 2px 3px rgba(0,0,0,.5);
    }
    /*#container { width: 99%; height: 10%; margin-left: 5px; margin:auto; }*/
    #container {
       min-height:100%;
       position:relative;
       width: 100%;
       min-height: 100%;
       height: auto !important;
       height: 100%;
       margin: 0px 0px -41px 0px;
    }
    #bottomButtons {
        left: 20px;
        position: fixed;
        bottom: 60px;
        width: 90%;
    }
    #addressButtons {
        float: left;
        bottom: 60px;
        position: relative;
        margin-left: 10px;
    }

    #feedbackDiv{
        float:left;
        min-width: 300px;
        width:65%;
        padding:10px;
        display:inline;
    }
    #controlDiv{
        float:left;
        min-width: 400px;
        padding:10px;
        width:30%;
        display:inline;
    } 
    #dialog-form {
        text-shadow: 0px 0px #000000;
    }
    .ui-dialog .ui-state-error { padding: .3em; }
        .validateTips { border: 1px solid transparent; padding: 0.1em; }
        input.text { margin-bottom:15px; width:97%; padding: .4em; }
        fieldset { padding:0; border:0; margin-top:25px; }
        h1 { font-size: 35px; margin: .6em 0;  text-shadow: 1px 1px #000000; color:white; font-weight: 900;}
        /*#f79d40*/
        div#users-contain { width: 350px; margin: 20px 0; }
        div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
        div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
        .ui-dialog .ui-state-error { padding: .3em; }
        .validateTips .privateKeyName { border: 1px solid transparent; padding: 0.3em; }
    input { 
        text-align:center; 
        border-radius: 10px;
        font-family:"Courier New", Courier, monospace;
    }


  .popover {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased!important;
    opacity: 1;
    background: #303f9f;
    padding: 0px;
    color: white;
    text-align:center;
    font: bold 12px "Helvetica Neue", Sans-Serif;
    text-transform:uppercase;
    z-index: 999999;
    min-width: 120px;
    line-height: 32px;
    background-color: rgba( 0,0,0,0.85 );
    box-shadow: 0 0 4px rgba( 0,0,0,0.3 );
    color: #fff;
  }
  .popover-title { display: none; }
#txDetails {
   margin-left: 5px;
}
#header {
   padding:10px;
   opacity: 1;
    background: #303f9f;
    color: white;
    text-align:center;
    min-width: 120px;
    line-height: 32px;
    background-color: rgba( 0,0,0,0.15 );
    box-shadow: 0 0 4px rgba( 0,0,0,0.3 );
}
#bodyDiv {
   padding:10px;
   padding-bottom:70px;   /* Height of the footer */
  overflow:auto;
}
#footer {
   position:relative;
   text-align: center;
   bottom:0;
   width:100%;
   margin-top: -70px; /* negative value of footer height */
   height:70px;   /* Height of the footer */
   /*background:#fc6b22;*/
    background-image: url(images/orangefooter.png);
    background-size: 100% 100%;
  clear:both;

}

.unselectable {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

</style>

</head>
<body>
    <div id="container">
            <div id="header">
                <div align="center" style="float:right;"><font size="2">Help<br></font>
                    <button id="help-button" title="Help" onclick="displayHelp();"><img src="./images/qmark.png"></button>
                </div> <!-- /help -->
                <div align="center" style="float:center;"><h1>Factoid Wallet GUI</h1></div>
            </div> <!-- /header -->
            
            <div id="bodyDiv">
                <div id="actionBar" align="center">
                    <div id="txDetails"> 
                        <div id="inputsDiv" style="float: left; margin-right: 50px; margin-bottom: 30px;">
                            <font size=17 align="center">Inputs</font><br>
                             <table id="inputTable" cellspacing="0" cellpadding="2">
                             <tr>
                                <td><label>Input Address</label></td>
                                <td><label id="inputLabel" for="inputQuantity">Amount</label></td>
                                <td data-placement="top" data-toggle="popover" data-content="Click to add another input to your transaction" data-trigger="manual"><button type="submit" id="addi-button" class="addi-button" title="New Input"><img src="./images/addbutton.png"></button></td>
                             </tr>
                             <tr>
                                <td><input type="text" id="txInput" size=54 class="keys" tabindex="1" maxlength="64"></td>
                                <td><input type="text" id="inputQuantity" size=14 class="qty" tabindex="2"></td> 
                                <td><button title="Delete Input" class="btnDelete">âœ–</button></td>
                                <td data-placement="bottom" data-toggle="popover" data-content="Add fee from input" data-trigger="manual"><button title="Include Fee" class="coverFee"><span style="font-size:12px; font-family: Arial; font-weight: bold;">+FEE</span></button></td>
                             </tr>
                             <tr id="inTotal">
                                <td align="right" style="text-align: right; padding-top: 25px; padding-right: 5px;"><label>Input Total: </label></td>
                                <td style="padding-top: 25px;"><input id="inTotalInput" type="text" value="0.0" size=14 disabled></td>
                                <td></td>
                                <td></td>
                             </tr>
                            </table>
                        </div> <!-- /inputsDiv -->
                        
                        <div id="outputsDiv" style="float: left; margin-bottom: 30px; margin-right: 50px;">
                            <font size=17 align="center">Outputs</font><br>
                            <table id="outputTable">
                                 <tr>
                                    <td><label>Output Address</label></td>
                                    <td><label id="outLabel" for="outQuantity">Amount</label></td>
                                    <td data-placement="top" data-toggle="popover" data-content="Click to add another output to your transaction" data-trigger="manual"><button type="submit" id="addo-button" class="addo-button" title="New Output"><img src="./images/addbutton.png"></button></td>
                                 </tr>
                                 <tr>                        
                                    <td><input type="text" id="txOutput" size=54 class="keys" tabindex="3" maxlength="64"></td>
                                    <td><input type="text" id="outputQuantity" size=14 class="qty" tabindex="4"></td> 
                                    <td><button title="Delete Output" class="btnDelete">âœ–</button></td>
                                    <td data-placement="bottom" data-toggle="popover" data-content="Deduct fee from output" data-trigger="manual"><button title="Subtract Fee" class="coverFee"><span style="font-size:12px; font-family: Arial; font-weight: bold;">-FEE</span></button></td>
                                 </tr> 
                                 <tr style="display:none;">
                                    <td data-placement="bottom" data-toggle="popover" data-content="Choose whether to send to a factoid or entry credit address" data-trigger="manual"><form id="outTypeForm"><input type="radio" name="outType" class="addresstype" value="fct" checked>â¨Ž <input type="radio" name="outType" class="addresstype" value="ec">EC</form>
                                    </td>
                                    <td></td>
                                    <td></td>
                                 </tr>
                                 <tr id="outTotal">
                                    <td align="right" style="text-align: right; padding-top: 25px; padding-right: 5px;"><label>Output Total: </label></td>
                                    <td style="padding-top: 25px;"><input id="outTotalInput" type="text" value="0.0" size=14 disabled></td>
                                    <td></td>
                                 </tr>
                            </table>
                        </div> <!-- /outputsDiv -->
                    </div> <!-- /txDetails -->


                    <br><br><br><br>

                    <div id="controlDiv"> 
                         <table id="controlButtons" cellspacing="5" cellpadding="2">
                             <tr><td><label>Transaction Name</label></td></tr> 
                             <tr>
                               <td data-placement="top" data-toggle="popover" data-content="Specify transaction name (if left blank, name is automatically generated)" data-trigger="manual"><input type="text" id="transactionNameInput" size=32 maxlength=32></td>
                               <td data-placement="top" data-toggle="popover" data-content="Load the transaction name in the box and populate page with transaction details" data-trigger="manual">
                                <button type="submit" id="loadName-button" class="loadName-button" title="Load Transaction To Form" onclick="grabTx()">
                                    <img src="./images/loadarrow.png"></button></td></tr>
                             <tr>
                               <td><div id="conversionRate"></div></td></tr>
                             <tr>
                               <td><label style="padding-right:10px;">Paying Fee: </label>   <label id="feeLabel">0.0</label><label class="unselectable" style="padding-left:5px;"><img src="./images/factoidsymbol.png" style="height: 25px; width: 25px;"></label> <label id="goodFee" style="font-size: 40px;" data-placement="right" data-toggle="popover" data-content="Shows whether transaction includes a sufficient fee" data-trigger="manual" data-container="body"></label></td>
                               <td >
                                </td>
                              </tr>
                             <tr>
                               <td><label>Required Fee: </label>
                                <label id="reqdFee">0.0</label><label class="unselectable" style="padding-left:5px;"><img src="./images/factoidsymbol.png" style="height: 25px; width: 25px;"></label></td>
                             <td><label>Delete Transaction</label></td>   
                             </tr>
                             <tr>
                               <td data-placement="top" data-toggle="popover" data-content="Click to refresh fee information" data-trigger="manual" data-container="body"><button id="refresh-button" title="Refresh Fee" onclick="refreshFee();">
                                <img src="./images/refresh.png"></button></td>
                               <td><button title="Delete Transaction" onclick="delTx();"><img src="./images/white-trash.png"></button></td>
                             </tr>
                             <tr>
                               <td><label>View Transaction</label></td>
                               <td><label>Export Transaction</label></td></tr>
                             <tr>
                               <td><button type="submit" id="view-button" class="view-button" title="View Transaction" onclick="getTx()"><img src="./images/white-view.png"></button></td>
                               <td><button type="submit" id="save-button" class="save-button" title="Save Transaction" onclick="saveTx()"><img src="./images/white-save.png"></button></td></tr>
                             <tr>
                               <td><label>Sign Transaction</label></td>
                               <td><label>Send Transaction</label></td></tr>
                             <tr>
                               <td><button type="submit" id="sign-button" class="sign-button" title="Sign Transaction" onclick="signTx()"><img src="./images/white-sign.png"></button></td>
                               <td><button type="submit" id="send-button" class="send-button" title="Sign&Submit Transaction" onclick="prepareTxSend()"><img src="./images/arrow-white.png"></button></td></tr>
                         </table>
                    </div> <!-- /controlDiv -->
                    
                    
                    <div id="feedbackDiv"> 
                         <textarea id="txtBox" type="text" value="" rows="22" cols="112" text-align=left readonly=true> <!-- disabled>-->
                         </textarea>

                        <br><br>
                        <table id="bottomButtonsTable">
                            <tr>
                             <td>Balance</td>
                             <td></td><td></td>
                             <td><label>List Transactions</label></td>
                             <td></td><td></td><td></td>
                             <td><label>View All Balances</label></td>
                            </tr>
                            <tr>
                                <td><button id="getBalButton" onclick="getIndividualBalance()"><img src="./images/magnify.png"></button></td>  
                                <td><button type="submit" id="addFactoidButton" class="afa-button" title="Add Factoid Address" onclick="newFCTAddress()" data-placement="bottom" data-toggle="popover" data-content="Add factoid address" data-trigger="manual" data-container="body"><img src="./images/addbutton.png"></button>â¨Ž</td>  
                                <td><button type="submit" id="addECButton" class="aeca-button" title="Add EC Address" onclick="newECAddress()" data-placement="top" data-toggle="popover" data-content="Add entry credit address" data-trigger="manual" data-container="body"><img src="./images/addbutton.png"></button>EC</td>
                                <td><button type="submit" id="transactions-button" class="transactions-button" title="View In-Progress Transactions" onclick="getTxs()"><img src="./images/ellipsis.png"></button></td>
                                <td><button type="submit" id="importTwelveWords-button" class="importTwelveWords-button" title="Import 12 Words" onclick="importFromTwelveWords()"  data-placement="bottom" data-toggle="popover" data-content="Import 12 words" data-trigger="manual"><img src="./images/twelve.png"></button></td>
                                <td width="140px"><button type="submit" id="importFromPK-button" class="importFromPK-button" title="Import From Private Key" onclick="importFromPK()" data-placement="top" data-toggle="popover" data-content="Import private key" data-trigger="manual"><img src="./images/key.png"></button></td>
                                <td><button type="submit" id="loadTx-button" class="loadTx-button" title="Load Transaction" onclick="loadTx()" data-placement="bottom" data-toggle="popover" data-content="Load transaction from file" data-trigger="manual"><img src="./images/folder.png"></button></td>                            
                                <td><button type="submit" id="balances-button" class="balances-button" title="View Balances" onclick="getBalances()"><img src="./images/white-list-icon.png"></button></td>
                        </table>
                    </div> <!-- /feedbackDiv -->
                </div> <!-- /actionBar -->
            </div> <!-- /bodyDiv -->

                
    </div> <!-- /container -->
    
    <div id="footer">
        <br>
       <a href="http://explorer.factom.org/"><img border="0" alt="Factom Explorer" src="images/logo-sm.png">
    </div> <!-- /footer -->
    
    <div id="dialog-form" title="Please">

      <p class="validateTips"></p>
      <form>
        <fieldset>
          <label class="dialogInputLabel"></label>
          <input type="text" name="primaryDialogInput" id="primaryDialogInput" value="" size=55 class="text ui-widget-content ui-corner-all">
          <div id="pkPart">
            <label class="privateKeyName">Name:<br></label>
            <input type="text" id="privateKeyName" class="text ui-widget-content ui-corner-all" size=32 maxlength=31>
          </div>

     
          <!-- Allow form submission with keyboard without duplicating the dialog button -->
          <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
        </fieldset>
      </form>

      <br><br>
    </div> <!-- /dialog-form -->
</body>

<script>
            document.body.style.zoom="70%";
            
            $( document ).ready(function() {
                showRate();
                ensureFeeRefresh();

            
//The following is a nifty little script which will prevent "-" and "e" characters from a text input field, while still allowing one "." character and copy+paste functionality
//Author: Joshua De Leon - credit www.transtatic.com
(function(b){var c={allowFloat:false,allowNegative:false};b.fn.numericInput=function(e){var f=b.extend({},c,e);var d=f.allowFloat;var g=f.allowNegative;this.keypress(function(j){var i=j.which;var h=b(this).val();if(i>0&&(i<48||i>57)){if(d==true&&i==46){if(g==true&&a(this)==0&&h.charAt(0)=="-"){return false}if(h.match(/[.]/)){return false}}else{if(g==true&&i==45){if(h.charAt(0)=="-"){return false}if(a(this)!=0){return false}}else{if(i==8){return true}else{return false}}}}else{if(i>0&&(i>=48&&i<=57)){if(g==true&&h.charAt(0)=="-"&&a(this)==0){return false}}}});return this};function a(d){if(d.selectionStart){return d.selectionStart}else{if(document.selection){d.focus();var f=document.selection.createRange();if(f==null){return 0}var e=d.createTextRange(),g=e.duplicate();e.moveToBookmark(f.getBookmark());g.setEndPoint("EndToStart",e);return g.text.length}}return 0}}(jQuery));
            
                $(".qty").numericInput({ allowFloat: true, allowNegative: false });
    
                var inputRows = 1;
                $("#addi-button").click(function() {
                    $("#inputTable tr").eq(1).clone().find("input").each(function() {
                        $(this).val('').attr('id', function(_, id) { return id + inputRows }).attr('tabindex', currTabIdx.toString());
                    }).end().insertBefore("#inTotal");
                    inputRows++;
                    currTabIdx++;
                    $('#inputTable input').on('keyup change', updateInputTotals);
                    $(".qty").numericInput({ allowFloat: true, allowNegative: false });
                    $( ".qty" ).change(function() {
                        this.value = parseFloat(this.value).toFixed(8) / 1;
                        if (isNaN(this.value)) { 
                            this.value = 0.0 
                        } 
                    });
                });
                
                var outputRows = 1;
                $("#addo-button").click(function() {
                    $("#outputTable tr").eq(1).clone().find("input").each(function() {
                        $(this).val('').attr('id', function(_, id) { return id + outputRows }).attr('tabindex', currTabIdx.toString());
                    }).end().insertBefore("#outTotal");
                    $("#outputTable tr").eq(2).clone().find("input").each(function() {
                        $(this).attr('name', function(_, name) { return name + outputRows });
                        $(this).closest('td').attr('data-toggle', '');
                    }).end().insertBefore("#outTotal");
                    outputRows++;
                    currTabIdx++;
                    $('#outputTable input').on('keyup change', updateOutputTotals);
                    $(".qty").numericInput({ allowFloat: true, allowNegative: false });
                    $( ".qty" ).change(function() {
                        this.value = parseFloat(this.value).toFixed(8) / 1;
                        if (isNaN(this.value)) { 
                            this.value = 0.0 
                        } 
                    });
                });

                getBalances()
            });
            
            
            
            function inArray(value, arr) {
                for(var i = 0; i < arr.length; i++) {
                    if (value === arr[i]) {
                        return i;
                    }
                }
                return -1;
            }


            function ensureFeeRefresh() {
                $( ".qty" ).change(function() {
                    this.value = parseFloat(this.value).toFixed(8) / 1;
                    if (isNaN(this.value)) { 
                        this.value = 0.0 
                    } 
                    updateInputTotals();
                    updateOutputTotals();
                    //refreshFee();
                });
                $( ".addresstype" ).change(function() {
                    refreshFee();
                });
            }
            
            
            $("#outputTable").on('click', '.btnDelete', function () {
                if($('#outputTable tr').length > 4) {
                    $(this).closest('tr').next('tr').remove();
                    $(this).closest('tr').remove();
                    currTabIdx--;
                    updateOutputTotals();
                    refreshFee();
                } else {
                    $(this).closest('tr').find("input").val("");
                    updateOutputTotals();
                    refreshFee();
                }
            });
            
            $("#inputTable").on('click', '.btnDelete', function () {
                if($('#inputTable tr').length > 3) {
                    $(this).closest('tr').remove();
                    currTabIdx--;
                    updateInputTotals();
                    refreshFee();
                } else {
                    $(this).closest('tr').find("input").val("");
                    updateInputTotals();
                    refreshFee();
                }
            });

            $("#inputTable").on('click', '.coverFee', function () {
                    thisButton = $(this);
                    var reqFee = parseFloat($('#reqdFee').text());
                    var currFee = parseFloat($('#feeLabel').text());
                    if(!isNaN(reqFee) && !isNaN(currFee)) {
                        var addQty = reqFee - currFee;
                        var strQty = $(this).closest('tr').find(".qty").val();
                        var currQty = parseFloat(strQty);
                        if(isNaN(currQty)) {
                            currQty = 0.0
                        }
                        var newQty = currQty + addQty;
                        $(this).closest('tr').find(".qty").val(newQty);
                        updateInputTotals();
                        $( ".qty" ).trigger("change");
                        refreshFee();
                        setTimeout(function(){
                            reqFee = parseFloat($('#reqdFee').text());
                            currFee = parseFloat($('#feeLabel').text());
                            if(currFee < reqFee) {
                                thisButton.trigger("click");
                            }
                        }, 100);
                    }
            });

            $("#outputTable").on('click', '.coverFee', function () {
                    thisButton = $(this);
                    var reqFee = parseFloat($('#reqdFee').text());
                    var currFee = parseFloat($('#feeLabel').text());
                    if(!isNaN(reqFee) && !isNaN(currFee)) {
                        var addQty = reqFee - currFee;
                        var strQty = $(this).closest('tr').find(".qty").val();
                        var currQty = parseFloat(strQty);
                        if(isNaN(currQty)) {
                            currQty = 0.0
                        }
                        var newQty = currQty - addQty;
                        $(this).closest('tr').find(".qty").val(newQty);
                        updateOutputTotals();
                        $( ".qty" ).trigger("change");
                        refreshFee();
                        setTimeout(function(){
                            reqFee = parseFloat($('#reqdFee').text());
                            currFee = parseFloat($('#feeLabel').text());
                            if(currFee < reqFee) {
                                thisButton.trigger("click");
                            }
                        }, 100);
                    }
            });

            
            $('#inputTable input').on('keyup change', updateInputTotals);            
            $('#outputTable input').on('keyup change', updateOutputTotals);
            
        function updateInputTotals() {
          $('td:not(:first-child):not(:last-child)',
            '#inputTable tr:eq(1)').each(function() {
            var ci= this.cellIndex;
            var total = 0;
            $('td', 
              '#inputTable tr:gt(0)')
              .filter(function() {
                return this.cellIndex === ci;
              })
              .each(function() {
                var inp= $('input', this);
                if(inp.length) {
                  if(!$(this).closest('tr').is(':last-child')) {
                    total+= $('input', this).val()*1;
                  }
                  else {
                    $('input', this).val(parseFloat(total).toFixed(8) / 1);
                  }
                }
              });

            //ensureFeeRefresh();
            
          });
          
          
          $('#inputTable tr:gt(0)').each(function() {
                var total = 0;
                $('td:not(:first-child):not(:last-child)',
                  this).each(function() {
                  total+= $('input', this).val()*1;
                });
              });
            };

        function updateOutputTotals() {
          $('td:not(:first-child):not(:last-child)',
            '#outputTable tr:eq(1)').each(function() {
            var ci= this.cellIndex;
            var total = 0;
            $('td', 
              '#outputTable tr:gt(0)')
              .filter(function() {
                return this.cellIndex === ci;
              })
              .each(function() {
                var inp= $('input', this);
                if(inp.length) {
                  if(!$(this).closest('tr').is(':last-child')) {
                    total+= $('input', this).val()*1;
                  }
                  else {
                    $('input', this).val(parseFloat(total).toFixed(8) / 1);
                  }
                }
              });
              
             //ensureFeeRefresh();
          });
          
          
          $('#outputTable tr:gt(0)').each(function() {
                var total = 0;
                $('td:not(:first-child):not(:last-child)',
                  this).each(function() {
                  total+= $('input', this).val()*1;
                });
              });
            };
          
            var refreshFee = function() {
                updateTransaction(buildTxFromPage(), "fee");
                updateFee();
                updateFeeLabel();
                setTimeout(function(){
                    var reqFee = parseFloat($('#reqdFee').text());
                    var currFee = parseFloat($('#feeLabel').text());
                    if(currFee >= reqFee && !isNaN(reqFee) && balanceCheck()) {
                        $('#goodFee').css("color", "green");
                        $('#goodFee').text("âœ”");
                    } else {
                        if(!isNaN(reqFee)) {
                            $('#goodFee').css("color", "red");
                            $('#goodFee').text("âœ—")
                        } else {
                            $('#goodFee').text("")
                        }
                    }
                }, 750);
            };
            
          var buildTxFromPage = function() {
                var inputQuantity, inputAddress, inString, outputQuantity, outputAddress, outputType, outString;

                var table = document.getElementById("inputTable");
                for (var i = 0, row; row = table.rows[i]; i++) {
                //iterate through rows
                    if(i === 0) {
                        inString = "[";
                    } else {
                        if(i >= table.rows.length - 1) {
                            inString = inString.concat(']');
                            break
                        }
                        inputAddress = table.rows[i].cells[0].childNodes[0].value.trim();
                        inputQuantity =  table.rows[i].cells[1].childNodes[0].value;
                        
                        if (inputQuantity && inputQuantity > 0 && inputAddress && inputAddress.length > 0) {
                            if(i > 1 && i < table.rows.length - 1) {
                                inString = inString.concat(',');
                            }
                            inString = inString.concat('{"inputSize": ')
                            inString = inString.concat(inputQuantity) 
                            inString = inString.concat(', "inputAddress": "')
                            inString = inString.concat(inputAddress)
                            inString = inString.concat('"}')
                        }
                    }
                }
                
                table = document.getElementById("outputTable");
                for (var j = 0, row; row = table.rows[j]; j++) {
                    if(j === 0) {
                        outString = "[";
                    } else {
                        if(j >= table.rows.length - 1) {
                            outString = outString.concat(']');
                            break
                        }
                        if(j % 2 == 0) {
                            if(table.rows[j].cells[0].childNodes[0].childNodes[0].checked){
                                outputType = "fct";
                            } else {
                                outputType = "ec";
                            }
                            
                            if (outputQuantity && outputQuantity > 0 && outputAddress && outputAddress.length > 0) {
                                if(j > 2 && j < table.rows.length - 1) {
                                    outString = outString.concat(',');
                                }
                                outString = outString.concat('{"outputSize": ')
                                outString = outString.concat(outputQuantity) 
                                outString = outString.concat(', "outputAddress": "')
                                outString = outString.concat(outputAddress)
                                outString = outString.concat('", "outputType": "')
                                outString = outString.concat(outputType)
                                outString = outString.concat('"}')
                            }
                            
                        } else {
                            outputAddress = table.rows[j].cells[0].childNodes[0].value.trim();
                            outputQuantity = table.rows[j].cells[1].childNodes[0].value;
                        }
                   }
                }
                //console.log("IN: ", inString, " OUT: ", outString);

                return [inString, outString];
          };
          
          
          var prepareTxSend = function() {
                var shouldWeSend = confirm("Are you sure you want to send this transaction?");
                if(shouldWeSend) {
                    updateTransaction(buildTxFromPage(), "send");
                }
                refreshFee();
          };
          
          var getTx = function() {
                updateTransaction(buildTxFromPage(), "print");
                refreshFee();
                //updateFee();
          };
          
          var saveTxToFile = function(txInformation, fileToSaveTo) {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                    txKey = "UITX"
                    $("#transactionNameInput").val(txKey)
                 }
         
             if(txInformation.length < 2) {
                console.log("Error with # of stuff in txInfo");
                return;
             } else {
                txInputs = txInformation[0];
                txOutputs = txInformation[1];                 

                 $.ajax({
                   url: 'tx',
                   type: 'get',
                   dataType: 'html',
                   data : { key: txKey, inputs: txInputs, outputs: txOutputs, action: "save", fileName: fileToSaveTo },
                   success : function(data) {
                             if(data === '' || typeof(data) === 'undefined') {
                                 $('#txtBox').text("Transaction invalid");
                             } else {
                                 $('#txtBox').text(data);
                             }
                   },
                 });
                         
              }      
          };
          
          var loadTx = function() {
                $(".validateTips").text("Please enter the name of the file to load from.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("File:");
                $( "#dialog-form" ).dialog('option', 'title', ("Load Transaction From File"))
                    .data('formType', "loadTx")
                    .dialog('open');

          };
          
          var saveTx = function() {
                $(".validateTips").text("Please enter the name of the file to save to.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("File:");
                $( "#dialog-form" ).dialog('option', 'title', ("Save Transaction To File"))
                    .data('formType', "saveTx")
                    .dialog('open');
                
          };
          
          var newFCTAddress = function() {
                $(".validateTips").text("Please enter a name for the new factoid address.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("Name:");
                $( "#dialog-form" ).dialog('option', 'title', ("New Address Name"))
                    .data('formType', "newFCTAddress")
                    .dialog('open');

          };

          var newECAddress = function() {
                $(".validateTips").text("Please enter a name for the new Entry Credit address.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("Name:");
                $( "#dialog-form" ).dialog('option', 'title', ("New Address Name"))
                    .data('formType', "newECAddress")
                    .dialog('open');

          };
          
          var getIndividualBalance = function() {
                $(".validateTips").text("What address would you like to view the balance for?");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("Address:");
                $( "#dialog-form" ).dialog('option', 'title', ("Balance"))
                    .data('formType', "balance")
                    .dialog('open');

          };
 
          var importFromPK = function() {
                $(".validateTips").text("");
                $("#pkPart").show();
                $(".dialogInputLabel").text("Private Key:");
                $( "#dialog-form" ).dialog('option', 'title', ("Import Private Key"))
                    .data('formType', "importPrivate")
                    .dialog('open');

          };         

          var importFromTwelveWords = function() {
                $(".validateTips").text("");
                $("#pkPart").show();
                $(".dialogInputLabel").text("Twelve words:");
                $( "#dialog-form" ).dialog('option', 'title', ("Import Twelve Words"))
                    .data('formType', "importTwelve")
                    .dialog('open');

          };       
          

          var signTx = function() {
                updateTransaction(buildTxFromPage(), "sign");
          };
          
          var seedWallet = function() {
                var inputSeed = prompt("What is your wallet seed?");
                console.log(inputSeed);
          };
          

//Dialog form controls
    $(function() {
        var dialog, form,
     
          primaryDialogInput = $( "#primaryDialogInput" ),
          allFields = $( [] ).add( primaryDialogInput );
          tips = $( ".validateTips" );
     
        function updateTips( t ) {
          tips
            .text( t )
            .addClass( "ui-state-highlight" );
          setTimeout(function() {
            tips.removeClass( "ui-state-highlight", 1500 );
          }, 500 );
        }
     
        function checkDialogInput() {
          var valid = true;
          var formType = $("#dialog-form").data('formType');
          allFields.removeClass( "ui-state-error" );
     
          switch(formType) {
            case "loadTx":
                loadTxFromFile(primaryDialogInput.val());
                break;
            case "saveTx":
                saveTxToFile(buildTxFromPage(), primaryDialogInput.val());
                break;
            case "newFCTAddress":
                addFCTAddress(primaryDialogInput.val());
                break;
            case "newECAddress":
                addECAddress(primaryDialogInput.val());
                break;
            case "importPrivate":
                importPrivKey(primaryDialogInput.val(), $("#privateKeyName").val());
                break;
            case "importTwelve":
                importTwelveWords(primaryDialogInput.val(), $("#privateKeyName").val());
                break;
            case "balance":
                getBalance(primaryDialogInput.val());
                break;
            default:
                console.log("NOT YET IMPLEMENTED FORMTYPE: " + formType.toString());
          }
          dialog.dialog( "close" );

        }
          
        //Dialog prompt
        dialog = $( "#dialog-form" ).dialog({
          autoOpen: false,
          height: 450,
          width: 800,
          modal: true,
          buttons: {
            "Done": checkDialogInput,
            Cancel: function() {
              dialog.dialog( "close" );
            }
          },
          close: function() {
            form[ 0 ].reset();
            allFields.removeClass( "ui-state-error" );
          }
        });
     
        form = dialog.find( "form" ).on( "submit", function( event ) {
          event.preventDefault();
          checkDialogInput();
        });
     
      });


</script>
</html>
