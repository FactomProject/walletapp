<!DOCTYPE html>
<html>
<head>
<title>Factoid Wallet GUI</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/png" href="./images/favicon.png">
<link rel="stylesheet" href="jquery-ui.css">

<script type="text/javascript" src="jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="jquery-ui.js"></script>

        <script type="text/javascript" charset="utf-8">
            var currTabIdx = 5;
            
            function showRate(){
              var elem = document.getElementById('conversionRate');
              elem.style.display = 'inline';
              $.ajax({
                   url: 'rate',
                   type: 'get',
                   dataType: 'html',
                   success : function(data) {
                         if(data === '') {
                             $(elem).text('...');
                         } else {
                             $(elem).text('1 EC = ' + data + '⨎');
                         }
                   }
               });
            }

          var sendPost = function (calltype, postdata, outputBox, ifEmptyString) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: calltype, ajax_post_data: postdata },
                       success : function(data) {
                             if(data === '') {
                                 $(outputBox).text(ifEmptyString);
                             } else {
                                 $(outputBox).text(data);
                             }
                       },
                     });
                  };
                  
                  
          var updateTransaction = function (txInformation, performAction) {
                     var txKey = $("#transactionNameInput").val(); 
                     if(!txKey || txKey.length < 1) {
                        txKey = "UITX"
                        $("#transactionNameInput").val(txKey)
                     }
         
                     if(txInformation.length < 2) {
                        console.log("Error with # of stuff in txInfo");
                        return;
                     } else {
                        txInputs = txInformation[0];
                        txOutputs = txInformation[1];
                        if(performAction === "send") {
                            if(!balanceCheck()) {
                                  $('#txtBox').text("Transaction imbalanced (the fee is much higher than it should be)!\n\nTransaction was not sent to network as a result.\n\nTo ensure the transaction is sent successfully, please make sure that the transaction fee being paid is less than 10 times the required fee.");
                                  return;
                            }
                         }
                         $.ajax({
                           url: 'tx',
                           type: 'get',
                           dataType: 'html',
                           data : { key: txKey, inputs: txInputs, outputs: txOutputs, action: performAction },
                           success : function(data) {
                                 if(performAction === "fee") {
                                     if(data === '' || typeof(data) === 'undefined') {
                                         $('#reqdFee').val("...");
                                     } else {
                                         $('#reqdFee').val(data);
                                     }
                                 } else {
                                     if(data === '' || typeof(data) === 'undefined') {
                                         $('#txtBox').text("Transaction invalid");
                                     } else {
                                         $('#txtBox').text(data);
                                     }
                                 }
                           },
                         }); 
                      }
                  };


          var updateFee = function () {
                     var txKey = $("#transactionNameInput").val(); 
                     if(!txKey || txKey.length < 1) {
                        txKey = "UITX"
                        $("#transactionNameInput").val(txKey)
                     }
         

                         $.ajax({
                           url: 'fee',
                           type: 'get',
                           dataType: 'html',
                           data : { key: txKey },
                           success : function(data) {
                                     if(data === '' || typeof(data) === 'undefined') {
                                         $('#reqdFee').val("...");
                                     } else {
                                         $('#reqdFee').val(data);
                                     }
                           }
                         });
          }
                                 
                  
          var balanceCheck = function() {
                refreshFee();
                var reqFee = parseFloat($('#reqdFee').val());
                var currFee = parseFloat($('#feeLabel').text());
                if(!isNaN(reqFee)) {
                    if(currFee <= (reqFee*10)) {
                            return true;
                      } else {
                            return false;
                      }
                } else {
                    return false;
                }
          };
                  
          var submitTx = function (txInputs, txOutputs) {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                    txKey = "UITX"
                    $("#transactionNameInput").val(txKey)
                 }
                     $.ajax({
                       url: 'tx',
                       type: 'get',
                       dataType: 'html',
                       data : { key: txKey, inputs: txInputs, outputs: txOutputs, action: "send" },
                       success : function(data) {
                             if(data === '' || typeof(data) === 'undefined') {
                                 $('#txtBox').text("Transaction invalid");
                             } else {
                                 $('#txtBox').text(data);
                             }
                       },
                     });

          };
                  
                          
          var updateFeeLabel = function () {
                var inputSize = parseFloat($('#inTotalInput').val());                
                var outputSize = parseFloat($('#outTotalInput').val());
                if (isNaN(outputSize) || outputSize === 0.0) {
                    var feeSize = inputSize
                } else {
                    var feeSize = inputSize - outputSize
                }
                if (isNaN(feeSize)) {
                    feeSize = 0.00
                }
                $('#feeLabel').text((feeSize.toPrecision(8) / 1).toString());   //divide by 1 to truncate trailing 0's without any regex
          };
          
          var getBalance = function () {
                 sendPost("balance", $('#txInput').val(), "#txtBox", "0.0 ⨎");
          };
                          
          var getBalances = function () {
                 sendPost("balances", '', "#txtBox", "NO BALANCES TO DISPLAY!");
          };
          
          var grabTx = function () {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                     $("#txtBox").text("Cannot load a no-name transaction.");
                 }
                 $.ajax({
                   url: 'loadtx',
                   type: 'post',
                   dataType: 'html',
                   data : { ajax_post_data: "", txName: txKey },
                   success : function(data) {
                         if(data === '') {
                             $("#txtBox").text("No such transaction.");
                         } else {
                             $("#txtBox").text("Transaction loaded into " + txKey + " successfully!");
                             populatePageFields(data);
                         }
                   },
                 });
          
          };

          var loadTxFromFile = function (fileName) {
                     var txKey = $("#transactionNameInput").val(); 
                     if(!txKey || txKey.length < 1) {
                        txKey = "UITX"
                        $("#transactionNameInput").val(txKey)
                     }
                     $.ajax({
                       url: 'loadtx',
                       type: 'post',
                       dataType: 'html',
                       data : { ajax_post_data: fileName, txName: txKey },
                       success : function(data) {
                             if(data === '') {
                                 $("#txtBox").text("No such file.");
                             } else {
                                $("#txtBox").text("Transaction loaded into " + txKey + " successfully!");
                                populatePageFields(data);
                             }
                       },
                     });
        
          };

          var populatePageFields = function(data) {
                    try {
                        var returnedTX = JSON.parse(data);
                    } catch (e) {
                         $("#txtBox").text(data + "\n\nThe output above is not a properly-JSON-formatted factoid transaction.");
                    }
                    //$("#txtBox").text(data);
                    $("#inputTable").find("tr:gt(1)").not(':last').remove();
                    if(returnedTX) {
                        for(var inIdx=0; inIdx < returnedTX.Inputs.length; inIdx++) {
                            var thisInput = returnedTX.Inputs[inIdx];
                            $( "#inputTable tr:nth-last-child(2)" ).children("td:first").find("input").val(thisInput.inputAddress);
                            $( "#inputTable tr:nth-last-child(2)" ).children("td:eq(1)").find("input").val(thisInput.inputSize / 100000000);
                            $("#addi-button").trigger("click");
                        }
                          $( "#inputTable tr:nth-last-child(2)" ).children("td:last").find("button").trigger("click");
                          
                          
                        for(var outIdx=0; outIdx < returnedTX.Outputs.length; outIdx++) {
                            var thisOutput = returnedTX.Outputs[outIdx];
                            $( "#outputTable tr:nth-last-child(3)" ).children("td:first").find("input").val(thisOutput.outputAddress);
                            $( "#outputTable tr:nth-last-child(3)" ).children("td:eq(1)").find("input").val(thisOutput.outputSize / 100000000);
                            if(thisOutput.outputType === "ec") {
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=fct]").prop('checked', false);
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=ec]").prop('checked', true);
                            } else {
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=fct]").prop('checked', true);
                                $( "#outputTable tr:nth-last-child(2)" ).children("td:first").find("input[value=ec]").prop('checked', false);
                            }
                            $("#addo-button").trigger("click");
                        }
                          $( "#outputTable tr:nth-last-child(3)" ).children("td:last").find("button").trigger("click");
                          updateInputTotals();
                          updateOutputTotals();
                          refreshFee();
                    }
          };
                      
          var getTxs = function () {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "allTxs", ajax_post_data: "" },
                       success : function(data) {
                             if(data === '') {
                                 $("#txtBox").text("NO TRANSACTIONS TO DISPLAY!");
                             } else {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };
          

          var addFCTAddress = function (addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "addNewAddress", ajax_post_data: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };
          
          var addECAddress = function (addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "addNewEC", ajax_post_data: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };
          
          var importPrivKey = function (privateKey, addName) {
                     $.ajax({
                       url: 'receive',
                       type: 'post',
                       dataType: 'html',
                       data : { call_type: "importPrivKey", ajax_post_data: privateKey, addressName: addName },
                       success : function(data) {
                             if(data != '') {
                                 $("#txtBox").text(data);
                             }
                       },
                     });
        
          };

              
          var displayHelp = function () {
                             $.ajax({
                               url: 'receive',
                               type: 'get',
                               dataType: 'html',
                               success : function(data) {
                                 $('#txtBox').text(data);
                               },
                             });
                          };
            
          </script>


<style type="text/css">
    html, body {
        background-image:url('images/bg.png');
        /*background-color:#1e2884;*/
        color:white;
        margin: 0;
        padding: 0;
        height: 98%;
        width: 100%;
        font: 18px Georgia, "Times New Roman", Times, serif;
    }
    #txtBox {
        font-size: large; 
        font-weight: bold; 
        color: white; 
        background-color: transparent;
    }
    button {
        background-color: Transparent;
        border: none;
        outline:none;
        cursor:pointer;
        color: white;
    }
    td {
        text-align: center;
    }
    button img {
        display: block;
        height: 30px;  
        width: 30px;
    }
    textarea {
        box-sizing:border-box;
        -moz-box-sizing:border-box;
        -webkit-box-sizing:border-box;
    }
    #inTotalInput, #outTotalInput {
        background-color: Transparent;
        color: white;
    }
    #container { width: 99%; height: 10%; margin-left: 5px; margin:auto; }
    #bottomButtons {
        left: 20px;
        position: fixed;
        bottom: 60px;
        width: 90%;
    }
    #addressButtons {
        float: left;
        bottom: 60px;
        position: relative;
        margin-left: 10px;
    }

    #feedbackDiv{
        float:left;
        /*border: 1px solid white;*/
        min-width: 300px;
        width:65%;
        padding:10px;
        display:inline;
    }
    #controlDiv{
        float:left;
        /*border: 1px solid white;*/
        min-width: 400px;
        padding:10px;
        width:30%;
        display:inline;
    } 
    .ui-dialog .ui-state-error { padding: .3em; }
            .validateTips { border: 1px solid transparent; padding: 0.1em; }
        /*body { font-size: 62.5%; }*/
        /*label, input { display:block; }*/
        input.text { margin-bottom:12px; width:97%; padding: .4em; }
        fieldset { padding:0; border:0; margin-top:25px; }
        h1 { font-size: 1.2em; margin: .6em 0; }
        div#users-contain { width: 350px; margin: 20px 0; }
        div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
        div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
        .ui-dialog .ui-state-error { padding: .3em; }
        .validateTips .privateKeyName { border: 1px solid transparent; padding: 0.3em; }
    input { text-align:center; }
</style>

</head>
<body>
    <div id="dialog-form" title="Direct coinflow">

      <p class="validateTips"></p>
      <form>
        <fieldset>
          <label class="dialogInputLabel"></label>
          <input type="text" name="primaryDialogInput" id="primaryDialogInput" value="" class="text ui-widget-content ui-corner-all">
          <div id="pkPart">
            <label class="privateKeyName">Name:<br></label>
            <input type="text" id="privateKeyName" class="text ui-widget-content ui-corner-all" size=32 maxlength=31>
          </div>

     
          <!-- Allow form submission with keyboard without duplicating the dialog button -->
          <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
        </fieldset>
      </form>

      <br><br>
    </div>
    
    <div style="width:100%; height:100%;">
        <div align="center" style="float:right;"><font size="2">Help<br></font>
            <button id="help-button" title="Help" onclick="displayHelp();"><img src="./images/qmark2.png"></button>
        </div>
        <div align="center" style="float:center;"><h1 class="heading">Factoid Wallet GUI</h1></div>
        <div id="container">
            <div id="actionBar" align="center">
                <div id="txDetails"> 
                    <div id="inputsDiv" style="float: left; margin-right: 100px; margin-bottom: 10px;">
                        <font size=17 align="center">Inputs</font><br>
                         <table id="inputTable" cellspacing="0" cellpadding="2">
                         <tr>
                            <td>Input Address</td>
                            <td><label id="inputLabel" for="inputQuantity">Amount</label></td>
                            <td><button type="submit" id="addi-button" class="addi-button" title="New Input"><img src="./images/addbutton.png"></button></td>
                         </tr>
                         <tr>
                            <td><input type="text" id="txInput" size=54 class="keys" tabindex="1"></td>
                            <td><input type="number" id="inputQuantity" class="qty" tabindex="2" min="0"></td> 
                            <td><button title="Delete Input" class="btnDelete">✖</button></td>
                         </tr>
                         <tr id="inTotal">
                            <td align="right">Input Total: </td>
                            <td><input id="inTotalInput" type="text" value="0.0" disabled></td>
                            <td></td>
                         </tr>
                        </table>
                    </div>
                    <div id="outputDiv" style="float: left; margin-bottom: 10px; margin-right: 100px;">
                        <font size=17 align="center">Outputs</font><br>
                        <table id="outputTable">
                         <tr>
                            <td>Output Address</td>
                            <td><label id="outLabel" for="outQuantity">Amount</label></td>
                            <td><button type="submit" id="addo-button" class="addo-button" title="New Output"><img src="./images/addbutton.png"></button></td>
                         </tr>
                         <tr>                        
                            <td><input type="text" id="txOutput" size=54 class="keys" tabindex="3"></td>
                            <td><input type="number" id="outputQuantity" class="qty" tabindex="4" min="0"></td> 
                            <td><button title="Delete Output" class="btnDelete">✖</button></td>
                         </tr> 
                         <tr>
                            <td><form id="outTypeForm"><input type="radio" name="outType" class="addresstype" value="fct" checked>⨎<input type="radio" name="outType" class="addresstype" value="ec">EC</form>
                            </td>
                            <td></td>
                            <td></td>
                         </tr>
                         <tr id="outTotal">
                            <td align="right">Output Total: </td>
                            <td><input id="outTotalInput" type="text" value="0.0" disabled></td>
                            <td></td>
                         </tr>
                        </table>
                    </div>
                </div>


                <br><br><br><br>

              <div id="controlDiv"> 
                     <table id="controlButtons" cellspacing="5" cellpadding="2">
                     <tr><td>Transaction Name</td></tr> 
                     <tr>
                       <td><input type="text" id="transactionNameInput" size=32 maxlength=32></td>
                       <td><button type="submit" id="loadName-button" class="loadName-button" title="Load Transaction To Form" onclick="grabTx()"><img src="./images/loadarrow.png"></button></td></tr>
                     <tr>
                       <td><div id="conversionRate"></div></td></tr>
                     <tr>
                       <td>Currently Paying Fee: <label id="feeLabel">0.0</label>⨎</td>
                       <td><label id="goodFee" style="font-size: 40px;"></label></td></tr>
                     <tr>
                       <td>Required Fee: <input type="text" id="reqdFee" size=7 style="border: none; background-color: transparent; color: white;" value="0.0" disabled>⨎</td></tr>
                     <tr>
                       <td><button  id="refresh-button" title="Refresh Fee" onclick="refreshFee();"><img src="./images/refresh.png"></button></td></tr>
                     <tr>
                       <td>View Transaction</td>
                       <td>Export Transaction</td></tr>
                     <tr>
                       <td><button type="submit" id="view-button" class="view-button" title="View Transaction" onclick="getTx()"><img src="./images/eye-white.png"></button></td>
                       <td><button type="submit" id="save-button" class="save-button" title="Save Transaction" onclick="saveTx()"><img src="./images/white-save.png"></button></td></tr>
                     <tr>
                       <td>Sign Transaction</td>
                       <td>Send Transaction</td></tr>
                     <tr>
                       <td><button type="submit" id="sign-button" class="sign-button" title="Sign Transaction" onclick="signTx()"><img src="./images/white-sign.png"></button></td>
                       <td><button type="submit" id="send-button" class="send-button" title="Sign&Submit Transaction" onclick="prepareTxSend()"><img src="./images/arrow-white.png"></button></td></tr>
                     </table>
                            <!--<input type="button" id="getBalButton" onclick="getBalance()" value="Individual Balance"> <br> --> 
                </div>
                <div id="feedbackDiv"> 
                     <textarea id="txtBox" type="text" value="" rows="22" cols="103" text-align=left readonly=true> <!-- disabled>-->
                     </textarea>

                    <br><br>
                    <table id="bottomButtonsTable">
                        <tr>
                         <td>View Transactions</td><td></td><td></td><td></td><td><td>View All Balances</td>
                        </tr>
                        <tr>
                            <td><button type="submit" id="transactions-button" class="transactions-button" title="View In-Progress Transactions" onclick="getTxs()"><img src="./images/ellipsis.png"></button></td>
                            <td><button type="submit" id="addFactoidButton" class="afa-button" title="Add Factoid Address" onclick="newFCTAddress()"><img src="./images/addbutton.png"></button>⨎</td>  
                            <td><button type="submit" id="addECButton" class="aeca-button" title="Add EC Address" onclick="newECAddress()"><img src="./images/addbutton.png"></button>EC</td>
                            <td><button type="importFromPK" id="importFromPK-button" class="importFromPK-button" title="Import From Private Key" onclick="importFromPK()"><img src="./images/key.png"></button></td>
                            <td><button type="submit" id="loadTx-button" class="loadTx-button" title="Load Transaction" onclick="loadTx()"><img src="./images/folder.png"></button></td>                            
                            <td><button type="submit" id="balances-button" class="balances-button" title="View Balances" onclick="getBalances()"><img src="./images/white-list-icon.png"></button></td>
                    </table>
                </div>



                
            </div>
        </div>
                    <div id="addressButtons">

                    </div>
    </div>

</body>

<script>
        
            $( document ).ready(function() {
                showRate();
                ensureFeeRefresh();
                
                var inputRows = 1;
                $("#addi-button").click(function() {
                    $("#inputTable tr").eq(1).clone().find("input").each(function() {
                        $(this).val('').attr('id', function(_, id) { return id + inputRows }).attr('tabindex', currTabIdx.toString());
                    }).end().insertBefore("#inTotal");
                    inputRows++;
                    currTabIdx++;
                    $('#inputTable input').on('keyup change', updateInputTotals);
                });
                
                var outputRows = 1;
                $("#addo-button").click(function() {
                    $("#outputTable tr").eq(1).clone().find("input").each(function() {
                        $(this).val('').attr('id', function(_, id) { return id + outputRows }).attr('tabindex', currTabIdx.toString());
                    }).end().insertBefore("#outTotal");
                    $("#outputTable tr").eq(2).clone().find("input").each(function() {
                        $(this).attr('name', function(_, name) { return name + outputRows });
                    }).end().insertBefore("#outTotal");
                    outputRows++;
                    currTabIdx++;
                    $('#outputTable input').on('keyup change', updateOutputTotals);
                });

                
                
                //getTxs()
                getBalances()
            });

            function inArray(value, arr) {
                for(var i = 0; i < arr.length; i++) {
                    if (value === arr[i]) {
                        return i;
                    }
                }
                return -1;
            }
            
            function ensureFeeRefresh() {
                $( ".qty" ).change(function() {
                    this.value = parseFloat(this.value).toFixed(8) / 1;
                    updateInputTotals();
                    updateOutputTotals();
                    refreshFee();
                });
                $( ".addresstype" ).change(function() {
                    refreshFee();
                });
            }
            
            $( ".keys" ).change(function() {
                //refreshFee();
            });  
            
            $("#outputTable").on('click', '.btnDelete', function () {
                if($('#outputTable tr').length > 4) {
                    $(this).closest('tr').next('tr').remove();
                    $(this).closest('tr').remove();
                    currTabIdx--;
                    updateOutputTotals();
                    refreshFee();
                }
            });
            
            $("#inputTable").on('click', '.btnDelete', function () {
                if($('#inputTable tr').length > 3) {
                    $(this).closest('tr').remove();
                    currTabIdx--;
                    updateInputTotals();
                    refreshFee();
                }
            });
            
            $('#inputTable input').on('keyup change', updateInputTotals);            
            $('#outputTable input').on('keyup change', updateOutputTotals);
            
        function updateInputTotals() {
          $('td:not(:first-child):not(:last-child)',
            '#inputTable tr:eq(1)').each(function() {
            var ci= this.cellIndex;
            var total = 0;
            $('td', 
              '#inputTable tr:gt(0)')
              .filter(function() {
                return this.cellIndex === ci;
              })
              .each(function() {
                var inp= $('input', this);
                if(inp.length) {
                  if(!$(this).closest('tr').is(':last-child')) {
                    total+= $('input', this).val()*1;
                  }
                  else {
                    $('input', this).val(parseFloat(total));
                  }
                }
              });

            ensureFeeRefresh();
            
          });
          
          
          $('#inputTable tr:gt(0)').each(function() {
                var total = 0;
                $('td:not(:first-child):not(:last-child)',
                  this).each(function() {
                  total+= $('input', this).val()*1;
                });
                //$('input', this).last().val(total);
              });
            };

        function updateOutputTotals() {
          $('td:not(:first-child):not(:last-child)',
            '#outputTable tr:eq(1)').each(function() {
            var ci= this.cellIndex;
            var total = 0;
            $('td', 
              '#outputTable tr:gt(0)')
              .filter(function() {
                return this.cellIndex === ci;
              })
              .each(function() {
                var inp= $('input', this);
                if(inp.length) {
                  if(!$(this).closest('tr').is(':last-child')) {
                    total+= $('input', this).val()*1;
                  }
                  else {
                    $('input', this).val(parseFloat(total));
                  }
                }
              });
              
             ensureFeeRefresh();
          });
          
          
          $('#outputTable tr:gt(0)').each(function() {
                var total = 0;
                $('td:not(:first-child):not(:last-child)',
                  this).each(function() {
                  total+= $('input', this).val()*1;
                });
                //$('input', this).last().val(total);
              });
            };
          
            var refreshFee = function() {
                updateTransaction(buildTxFromPage(), "fee");
                updateFee();
                updateFeeLabel();
                setTimeout(function(){
                    var reqFee = parseFloat($('#reqdFee').val());
                    var currFee = parseFloat($('#feeLabel').text());
                    console.log("REQ : " + reqFee);
                    console.log("curr! : " + currFee);
                    if(currFee >= reqFee && !isNaN(reqFee)) {
                        $('#goodFee').css("color", "green");
                        $('#goodFee').text("✔");
                    } else {
                        if(!isNaN(reqFee)) {
                            $('#goodFee').css("color", "red");
                            $('#goodFee').text("✗")
                        } else {
                            $('#goodFee').text("")
                        }
                    }
                }, 750);
            };
            
          var buildTxFromPage = function() {
                var inputQuantity, inputAddress, inString, outputQuantity, outputAddress, outputType, outString;

                var table = document.getElementById("inputTable");
                for (var i = 0, row; row = table.rows[i]; i++) {
                //iterate through rows
                    if(i === 0) {
                        inString = "[";
                    } else {
                        if(i >= table.rows.length - 1) {
                            inString = inString.concat(']');
                            break
                        }
                        inputAddress = table.rows[i].cells[0].childNodes[0].value;
                        inputQuantity =  table.rows[i].cells[1].childNodes[0].value;
                        
                        if (inputQuantity && inputQuantity > 0 && inputAddress && inputAddress.length > 0) {
                            if(i > 1 && i < table.rows.length - 1) {
                                inString = inString.concat(',');
                            }
                            inString = inString.concat('{"inputSize": ')
                            inString = inString.concat(inputQuantity) 
                            inString = inString.concat(', "inputAddress": "')
                            inString = inString.concat(inputAddress)
                            inString = inString.concat('"}')
                        }
                    }
                }
                
                table = document.getElementById("outputTable");
                for (var j = 0, row; row = table.rows[j]; j++) {
                    if(j === 0) {
                        outString = "[";
                    } else {
                        if(j >= table.rows.length - 1) {
                            outString = outString.concat(']');
                            break
                        }
                        if(j % 2 == 0) {
                            if(table.rows[j].cells[0].childNodes[0].childNodes[0].checked){
                                outputType = "fct";
                            } else {
                                outputType = "ec";
                            }
                            
                            if (outputQuantity && outputQuantity > 0 && outputAddress && outputAddress.length > 0) {
                                if(j > 2 && j < table.rows.length - 1) {
                                    outString = outString.concat(',');
                                }
                                outString = outString.concat('{"outputSize": ')
                                outString = outString.concat(outputQuantity) 
                                outString = outString.concat(', "outputAddress": "')
                                outString = outString.concat(outputAddress)
                                outString = outString.concat('", "outputType": "')
                                outString = outString.concat(outputType)
                                outString = outString.concat('"}')
                            }
                            
                        } else {
                            outputAddress = table.rows[j].cells[0].childNodes[0].value;
                            outputQuantity = table.rows[j].cells[1].childNodes[0].value;
                        }
                   }
                }
                console.log("IN: ", inString, " OUT: ", outString);

                return [inString, outString];
                //refreshFee();
          };
          
          
          var prepareTxSend = function() {
                var shouldWeSend = confirm("Are you sure you want to send this transaction?");
                if(shouldWeSend) {
                    updateTransaction(buildTxFromPage(), "send");
                }
                refreshFee();
          };
          
          var getTx = function() {
                updateTransaction(buildTxFromPage(), "print");
                refreshFee();
                //updateFee();
          };
          
          var saveTxToFile = function(txInformation, fileToSaveTo) {
                 var txKey = $("#transactionNameInput").val(); 
                 if(!txKey || txKey.length < 1) {
                    txKey = "UITX"
                    $("#transactionNameInput").val(txKey)
                 }
         
             if(txInformation.length < 2) {
                console.log("Error with # of stuff in txInfo");
                return;
             } else {
                txInputs = txInformation[0];
                txOutputs = txInformation[1];                 

                 $.ajax({
                   url: 'tx',
                   type: 'get',
                   dataType: 'html',
                   data : { key: txKey, inputs: txInputs, outputs: txOutputs, action: "save", fileName: fileToSaveTo },
                   success : function(data) {
                             if(data === '' || typeof(data) === 'undefined') {
                                 $('#txtBox').text("Transaction invalid");
                             } else {
                                 $('#txtBox').text(data);
                             }
                   },
                 });
                         
              }      
                //buildTxFromPage("save");
          };
          
          var loadTx = function() {
                $(".validateTips").text("Please enter the name of the file to load from.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("File:");
                $( "#dialog-form" ).dialog('option', 'title', ("Load Transaction From File"))
                    .data('formType', "loadTx")
                    .dialog('open');

          };
          
          var saveTx = function() {
                $(".validateTips").text("Please enter the name of the file to save to.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("File:");
                $( "#dialog-form" ).dialog('option', 'title', ("Save Transaction To File"))
                    .data('formType', "saveTx")
                    .dialog('open');
                
          };
          
          var newFCTAddress = function() {
                $(".validateTips").text("Please enter a name for the new factoid address.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("Name:");
                $( "#dialog-form" ).dialog('option', 'title', ("New Address Name"))
                    .data('formType', "newFCTAddress")
                    .dialog('open');

          };

          var newECAddress = function() {
                $(".validateTips").text("Please enter a name for the new Entry Credit address.");
                $("#pkPart").hide();
                $(".dialogInputLabel").text("Name:");
                $( "#dialog-form" ).dialog('option', 'title', ("New Address Name"))
                    .data('formType', "newECAddress")
                    .dialog('open');

          };
 
          var importFromPK = function() {
                $(".validateTips").text("");
                $("#pkPart").show();
                $(".dialogInputLabel").text("Private Key:");
                $( "#dialog-form" ).dialog('option', 'title', ("Import Private Key"))
                    .data('formType', "importPrivate")
                    .dialog('open');

          };         
          

          var signTx = function() {
                updateTransaction(buildTxFromPage(), "sign");
          };
          
          var seedWallet = function() {
                var inputSeed = prompt("What is your wallet seed?");
                console.log(inputSeed);
          };
          

//This is all from giuseppe
    $(function() {
        var dialog, form,
     
          primaryDialogInput = $( "#primaryDialogInput" ),
          //amountToSend = $( "#sendAmount" ),
          allFields = $( [] ).add( primaryDialogInput );//.add( amountToSend ),
          tips = $( ".validateTips" );
     
        function updateTips( t ) {
          tips
            .text( t )
            .addClass( "ui-state-highlight" );
          setTimeout(function() {
            tips.removeClass( "ui-state-highlight", 1500 );
          }, 500 );
        }
     
        function checkDialogInput() {
          var valid = true;
          var formType = $("#dialog-form").data('formType');
          allFields.removeClass( "ui-state-error" );
     
          switch(formType) {
            case "loadTx":
                loadTxFromFile(primaryDialogInput.val());
                break;
            case "saveTx":
                saveTxToFile(buildTxFromPage(), primaryDialogInput.val());
                break;
            case "newFCTAddress":
                addFCTAddress(primaryDialogInput.val());
                break;
            case "newECAddress":
                addECAddress(primaryDialogInput.val());
                break;
            case "importPrivate":
                importPrivKey(primaryDialogInput.val(), $("#privateKeyName").val());
                break;
            default:
                console.log("NOT YET IMPLEMENTED FORMTYPE: " + formType.toString());
          }
          dialog.dialog( "close" );

        }
          
        //Dialog prompt for sending coins from origin to recipient
        dialog = $( "#dialog-form" ).dialog({
          autoOpen: false,
          height: 420,
          width: 590,
          modal: true,
          buttons: {
            "Done": checkDialogInput,
            Cancel: function() {
              dialog.dialog( "close" );
            }
          },
          close: function() {
            form[ 0 ].reset();
            allFields.removeClass( "ui-state-error" );
          }
        });
     
        form = dialog.find( "form" ).on( "submit", function( event ) {
          event.preventDefault();
          checkDialogInput();
        });
     
      });


</script>
</html>
